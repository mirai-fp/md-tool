<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout :: commonHead">
    <title>åˆ†æçµæœä¸€è¦§</title>
</head>
<body>
<header th:replace="layout :: commonHeader"></header>
<main class="container py-5">
    <div class="text-center mb-5">
        <h1 class="display-6 fw-bold text-muted">åˆ†æçµæœ</h1>
        <p class="text-muted">å£²ä¸Šã¨å•†å“åˆ¥ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã§ãã¾ã™</p>
    </div>

    <!-- æ¤œç´¢æ¡ä»¶ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="card card-custom p-4 mb-4">
        <form th:action="@{/analysis}" method="get" class="row g-3 justify-content-center">
            <div class="col-md-4">
                <label for="startDate" class="form-label">é–‹å§‹æ—¥ä»˜</label>
                <input type="date" id="startDate" name="startDate" class="form-control" required
                       th:value="${param.startDate}" />
            </div>
            <div class="col-md-4">
                <label for="endDate" class="form-label">çµ‚äº†æ—¥ä»˜</label>
                <input type="date" id="endDate" name="endDate" class="form-control" required
                       th:value="${param.endDate}" />
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">æ¤œç´¢</button>
            </div>
        </form>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            if (!startDateInput.value || !endDateInput.value) {
                const today = new Date();
                const day = today.getDay();
                const lastSunday = new Date(today);
                lastSunday.setDate(today.getDate() - day);
                const lastMonday = new Date(lastSunday);
                lastMonday.setDate(lastSunday.getDate() - 6);

                const formatDate = (date) => {
                    const y = date.getFullYear();
                    const m = String(date.getMonth() + 1).padStart(2, '0');
                    const d = String(date.getDate()).padStart(2, '0');
                    return `${y}-${m}-${d}`;
                };

                endDateInput.value = formatDate(lastSunday);
                startDateInput.value = formatDate(lastMonday);
            }
        });
    </script>

    <div class="card card-custom p-4 mb-5">
        <h2 class="mb-4 fw-bold text-muted text-center">å…¨ä½“ å£²ä¸Šçµæœ</h2>
        <div class="table-responsive">
            <table class="table table-hover table-bordered text-center align-middle">
                <thead>
                <tr>
                    <th>å­å•†å“ã‚¿ã‚¤ãƒ—</th>
                    <th>å£²ä¸Šé‡‘é¡åˆè¨ˆ</th>
                    <th>å£²ä¸Šé‡‘é¡ å‰é€±æ¯” (%)</th>
                    <th>å£²ä¸Šæ•°é‡åˆè¨ˆ</th>
                    <th>å£²ä¸Šæ•°é‡ å‰é€±æ¯” (%)</th>
                    <th>ç²—åˆ©</th>
                    <th>ç²—åˆ©ç‡ (%)</th>
                    <th>æ˜¨å¹´ç²—åˆ©</th>
                    <th>æ˜¨å¹´ç²—åˆ©ç‡ (%)</th>
                    <th>å£²ä¸Šæ§‹æˆæ¯” (%)</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="result : ${record}">
                    <td th:text="${result.childProductType}"></td>
                    <td th:text="${#numbers.formatDecimal(result.salesAmount, 1, 'COMMA', 0, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.salesAmountChangeRate, 1, 'COMMA', 2, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.quantity, 1, 'COMMA', 0, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.quantityChangeRate, 1, 'COMMA', 2, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.profit, 1, 'COMMA', 0, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.profitRate, 1, 'COMMA', 2, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.previousYearProfit, 1, 'COMMA', 0, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.previousYearProfitRate, 1, 'COMMA', 2, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.salesCompositionRate, 1, 'COMMA', 2, 'POINT')}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card card-custom p-4">
        <h2 class="mb-4 fw-bold text-muted text-center">å•†å“åˆ¥ å£²ä¸Šçµæœ</h2>
        <div class="table-responsive">
            <table class="table table-hover table-bordered text-center align-middle">
                <thead>
                <tr>
                    <th>ãƒ–ãƒ©ãƒ³ãƒ‰å“ç•ª</th>
                    <th>å•†å“å</th>
                    <th>å£²é‡‘</th>
                    <th>å£²ä¸Šæ•°é‡</th>
                    <th>åŸä¾¡</th>
                    <th>åˆ©ç›Š</th>
                    <th>ç™ºæ³¨æ•°</th>
                    <th>åœ¨åº«</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="result : ${itemRecord}">
                    <td th:text="${result.brandCode}"></td>
                    <td th:text="${result.productName}"></td>
                    <td th:text="${#numbers.formatDecimal(result.totalSales, 1, 'COMMA', 0, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.totalSalesAmount, 1, 'COMMA', 0, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.totalWholeSales, 1, 'COMMA', 0, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.profit, 1, 'COMMA', 0, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.orderAmount, 1, 'COMMA', 0, 'POINT')}"></td>
                    <td th:text="${#numbers.formatDecimal(result.stock, 1, 'COMMA', 0, 'POINT')}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="text-center mt-5">
        <a href="/" class="btn btn-home btn-lg">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
    </div>

    <div th:replace="layout :: commonScripts"></div>
</main>
</body>
</html>
